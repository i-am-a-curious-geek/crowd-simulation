<!DOCTYPE html>
<html lang="en">
    <head>            
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
        <title>Home</title>
        <link rel="stylesheet" type="text/css" href="css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="css/leaflet.css" />  
        <link rel="stylesheet" type="text/css" href="css/font-awesome.min.css" />          
        <link rel="stylesheet" type="text/css" href="css/smoothness/jquery-ui.css">        
        <link rel="stylesheet" type="text/css" href="css/home.css" />  
        <link rel="shortcut icon" href="favicon.ico" />       
    </head>
    <body>
        <div id="wrapper">               
            <div class="radial-menu">
                <div class="menu-item1">Option 1</div>
                <div class="menu-item2">Option 2</div>
                <div class="menu-item3">Option 3</div>
                <div class="menu-item4"><i class="fa fa-times fa-2x"></i></div>
                <div class="mask"><i class="fa fa-bars fa-3x"></i></div>
            </div>
            <!--<div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-th"></i> Data Table</h3>
                </div>
                <div class="panel-body">                                                        
                    Data                           
                </div>
            </div>

            <div class="panel panel-primary">
                <div class="panel-heading">
                    <h3 class="panel-title"><i class="fa fa-pie-chart"></i> Charts</h3>
                </div>
                <div class="panel-body">                                                        
                    Charts                           
                </div>
            </div>-->            
        </div>
        <script type="text/javascript" src="js/jquery.min.js"></script>
        <script type="text/javascript" src="js/jquery-ui.js"></script>
        <script type="text/javascript" src="js/bootstrap.min.js"></script>
        <script type="text/javascript" src="js/leaflet.js"></script>        
        <script type="text/javascript" src="js/leaflet.ajax.js"></script>
        <script type="text/javascript" src="js/autolinker.min.js"></script>
        <script type="text/javascript" src="js/panels.js"></script>
        <script type="text/javascript">
            var map;
            $(document).ready(function () {
                map = L.map('wrapper', {
                    center: [1.3521, 103.8198],
                    zoom: 11
                });

                var layer_group = new L.layerGroup([]);
                var basemap = L.tileLayer('http://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}.png');
                layer_group.addLayer(basemap);
                layer_group.addTo(map);

                var feature_group = new L.featureGroup([]);

                var mapLayerJSON = new L.GeoJSON.AJAX("data/singapore.json", {
                    style: {
                        color: '#c4c4c4',
                        weight: '6.0',
                        fillColor: '#08306b',
                        opacity: '1.0',
                        fillOpacity: '0.0',
                    }
                });

                feature_group.addLayer(mapLayerJSON);
                feature_group.addTo(map);

                L.control.scale({options: {position: "bottomleft", maxWidth: 100, metric: true, imperial: false, updateWhenIdle: false}}).addTo(map);

                var getRandomLocation = function (latitude, longitude, radiusInMeters) {
                    var getRandomCoordinates = function (radius, uniform) {
                        var a = Math.random(),
                                b = Math.random();

                        if (uniform) {
                            if (b < a) {
                                var c = b;
                                b = a;
                                a = c;
                            }
                        }

                        return [
                            b * radius * Math.cos(2 * Math.PI * a / b),
                            b * radius * Math.sin(2 * Math.PI * a / b)
                        ];
                    };
                    var randomCoordinates = getRandomCoordinates(radiusInMeters, true);
                    var earth = 6378137;
                    var northOffset = randomCoordinates[0],
                            eastOffset = randomCoordinates[1];
                    var offsetLatitude = northOffset / earth,
                            offsetLongitude = eastOffset / (earth * Math.cos(Math.PI * (latitude / 180)));
                    return {
                        latitude: latitude + (offsetLatitude * (180 / Math.PI)),
                        longitude: longitude + (offsetLongitude * (180 / Math.PI))
                    }
                };
                
                /*
                map.on('click', function (e) {
                    prompt(e.latlng.lat + ", " + e.latlng.lng, e.latlng.lat + ", " + e.latlng.lng)
                })
                */
               
                var point;
                var pointArr = [];

                var pointProperties = {
                    color: 'darkgreen',
                    fillColor: 'lightgreen',
                    fillOpacity: 1.0
                };

                var latlong;
                var i;
                var p;
                
                var distance = 4000; // in metres
                var noOfppl = 50;
                
                function crowdMovement() {
                    for (i = 0; i < noOfppl; i++) {
                        latlong = getRandomLocation(1.3521, 103.8198, distance);
                        point = L.circle([latlong["latitude"], latlong["longitude"]], 50, pointProperties);
                        pointArr.push(point); 
                        point.addTo(map);
                    }

                    for (i = 0; i < noOfppl; i++) {
                        latlong = getRandomLocation(1.4269307173650994, 103.81324768066406, distance);
                        point = L.circle([latlong["latitude"], latlong["longitude"]], 50, pointProperties);
                        pointArr.push(point); 
                        point.addTo(map);
                    }

                    for (i = 0; i < noOfppl; i++) {
                        latlong = getRandomLocation(1.3670959104527012, 103.90079498291016, distance);
                        point = L.circle([latlong["latitude"], latlong["longitude"]], 50, pointProperties);
                        pointArr.push(point);
                        point.addTo(map);
                    }

                    for (i = 0; i < noOfppl; i++) {
                        latlong = getRandomLocation(1.361604303714409, 103.7112808227539, distance);
                        point = L.circle([latlong["latitude"], latlong["longitude"]], 50, pointProperties);
                        pointArr.push(point);
                        point.addTo(map);
                    }

                    for (i = 0; i < noOfppl; i++) {
                        latlong = getRandomLocation(1.3699561173272734, 103.76792907714844, distance);
                        point = L.circle([latlong["latitude"], latlong["longitude"]], 50, pointProperties);
                        pointArr.push(point);
                        point.addTo(map);
                    }

                    for (i = 0; i < noOfppl; i++) {
                        latlong = getRandomLocation(1.3466167301443492, 103.97117614746094, distance);
                        point = L.circle([latlong["latitude"], latlong["longitude"]], 50, pointProperties);
                        pointArr.push(point);
                        point.addTo(map);
                    }
                    
                    for (i = 0; i < noOfppl; i++) {
                        latlong = getRandomLocation(1.3013102263776561, 103.82560729980469, distance);
                        point = L.circle([latlong["latitude"], latlong["longitude"]], 50, pointProperties);
                        pointArr.push(point);
                        point.addTo(map);
                    }                    
                }
                
                setInterval(function () {
                    crowdMovement();
                    
                    for (p = 0; p < pointArr.length; p++) {
                        map.removeLayer(pointArr[p]); 
                    } 
                    
                    crowdMovement();
                }, 5000);
                
                /*
                 $(".panel, #main-menu").on("mouseover", function() {                     
                 map.dragging.disable(); 
                 }); 
                 
                 $(".panel, #main-menu").on("mouseout", function() {                     
                 map.dragging.enable(); 
                 });
                 */

                var active1 = false;
                var active2 = false;
                var active3 = false;
                var active4 = false;

                $('.radial-menu').on('mousedown touchstart', function () {
                    if (!active1) {
                        $(this).find('.menu-item1').css({'background-color': 'gray', 'transform': 'translate(0px,125px)'});
                    } else {
                        $(this).find('.menu-item1').css({'background-color': 'dimGray', 'transform': 'none'});
                    }

                    if (!active2) {
                        $(this).find('.menu-item2').css({'background-color': 'gray', 'transform': 'translate(60px,105px)'});
                    } else {
                        $(this).find('.menu-item2').css({'background-color': 'darkGray', 'transform': 'none'});
                    }

                    if (!active3) {
                        $(this).find('.menu-item3').css({'background-color': 'gray', 'transform': 'translate(105px,60px)'});
                    } else {
                        $(this).find('.menu-item3').css({'background-color': 'silver', 'transform': 'none'});
                    }

                    if (!active4) {
                        $(this).find('.menu-item4').css({'background-color': 'gray', 'transform': 'translate(125px,0px)'});
                    } else {
                        $(this).find('.menu-item4').css({'background-color': 'silver', 'transform': 'none'});
                    }

                    active1 = !active1;
                    active2 = !active2;
                    active3 = !active3;
                    active4 = !active4;
                });

            });
        </script>     
    </body>
</html>
